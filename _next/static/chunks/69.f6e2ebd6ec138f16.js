"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69],{71584:function(e,t,r){r.d(t,{F:function(){return o},s:function(){return a}});var n=r(85893),o=function(e){var t=e.text,r=e.onClick,o=e.isTight;return o=null!==o&&void 0!==o&&o?"w-full md:w-[170px]":"md:w-[202px]",(0,n.jsx)("button",{onClick:r,className:"".concat(o," group hover:text-white normal-case flex btn bg-transparent text-center font-bold text-black border  border-black  rounded-lg h-12"),children:t})},a=function(e){var t=e.text,r=e.onClick,o=e.isTight;return o=null!==o&&void 0!==o&&o?"w-[98%] md:w-[120px] ":"w-[127.5px] md:w-[202px]",(0,n.jsx)("button",{onClick:r,className:"".concat(o,"  group hover:bg-white hover:text-black normal-case flex btn text-center font-bold bg-black border text-white rounded-lg h-12"),children:t})}},35069:function(e,t,r){r.r(t),r.d(t,{default:function(){return C}});var n=r(34051),o=r.n(n),a=r(85893),s=r(9367),i=r(67294),c=r(71463),u=r(71584),l=r(83977),f=r(20061);function p(e,t,r,n,o,a,s){try{var i=e[a](s),c=i.value}catch(u){return void r(u)}i.done?t(c):Promise.resolve(c).then(n,o)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function s(e){p(a,n,o,s,i,"next",e)}function i(e){p(a,n,o,s,i,"throw",e)}s(void 0)}))}}var h,m=(0,l.ZF)({apiKey:"AIzaSyAhJOKFbBZGLAF7kgSBXYOQNeOSfwq30B8",authDomain:"personalweb-9a157.firebaseapp.com",projectId:"personalweb-9a157",storageBucket:"personalweb-9a157.appspot.com",messagingSenderId:"535997393456",appId:"1:535997393456:web:15a8e4ffcfde94ba221bf5",measurementId:"G-4P7PPBN11C"}),g=(0,f.KL)(m),b=function(){var e=d(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=7;break}return e.next=3,window.navigator.serviceWorker.getRegistration("/firebase-push-notification-scope");case 3:if(!(t=e.sent)){e.next=6;break}return e.abrupt("return",t);case 6:return e.abrupt("return",window.navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-push-notification-scope"}));case 7:throw new Error("The browser doesn`t support service worker.");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=d(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b().then((function(e){return(0,f.LP)(g,{vapidKey:"BFSgOEVNbWPVgxaPQ4w1MyAigFGNz_KitopsjPXbcCqE3XjvyriHyQ1BZt2_jwygYg79TACuo8MbyU3_Qvo9VHA",serviceWorkerRegistration:e})})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),v=r(69483),w=r.n(v),y=r(55678);r(40993);function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function j(e,t,r,n,o,a,s){try{var i=e[a](s),c=i.value}catch(u){return void r(u)}i.done?t(c):Promise.resolve(c).then(n,o)}function N(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function s(e){j(a,n,o,s,i,"next",e)}function i(e){j(a,n,o,s,i,"throw",e)}s(void 0)}))}}function A(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return k(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(){var e=(0,i.useState)(""),t=e[0],r=e[1],n=(0,i.useState)(""),l=n[0],f=n[1],p=(0,i.useState)(""),d=p[0],m=p[1],g=(0,i.useState)([]),b=g[0],v=g[1],k=(0,i.useState)(),j=k[0],C=k[1];(0,i.useEffect)((function(){P()}),[]),(0,i.useEffect)((function(){S()}),[]);var S=function(){var e=N(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w().getItem("fcm_token");case 2:if(t=e.sent,console.log(t),null===t){e.next=8;break}return C(t),console.log("tokenInLocalForage"),e.abrupt("return");case 8:if(r=x(),console.log(r),!r){e.next=15;break}return w().setItem("fcm_token",r),C(r),console.log("firebaseToken"),e.abrupt("return");case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=N(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/socket");case 2:(h=(0,s.ZP)()).on("newIncomingMessage",function(){var e=N(o().mark((function e(t){var r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v((function(e){return A(e).concat([{author:t.author,message:t.message}])})),I(t),e.next=4,w().getItem("fcm_token");case 4:r=e.sent,n=j||r,console.log("fcm",n),n&&(a={to:n,priority:"high",notification:{title:"You got a new chat message",body:t.message}},fetch("https://fcm.googleapis.com/fcm/send",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"key=AAAAfMvvKjA:APA91bG0ogWNGXOgmMK2Ffnx9C-NoiiJ3WLtiu18GW_etu5CM9UYz9jJT0TBYKE1i0nv2_0Eg9pE_Zt8aaUoN5ENrYXmzHxUt2KIzfCo7b85SqRY8-ikQyA3ceZQtyOfaWP7DN9a103F"},body:JSON.stringify(a)})),console.log(b);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(e){(0,y.Am)(e.author+": "+e.message,{position:"top-right",autoClose:3e3,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"light"})},E=function(){var e=N(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h.emit("createdMessage",{author:l,message:d}),v((function(e){return A(e).concat([{author:l,message:d}])})),m("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,a.jsx)(c.Z,{title:"Chat Room",children:(0,a.jsx)("div",{className:"flex items-center p-4 mx-auto min-h-screen justify-center",children:(0,a.jsx)("main",{className:"gap-4 flex flex-col items-center justify-center w-full h-full",children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"font-bold text-black text-xl",children:["Your username: ",t]}),(0,a.jsxs)("div",{className:"flex flex-col justify-end border-t-2 bg-white h-[20rem] min-w-[33%] rounded-md shadow-md ",children:[(0,a.jsx)("div",{className:"h-full last:border-b-0 overflow-y-scroll",children:b.map((function(e,t){return(0,a.jsxs)("div",{className:"w-full py-1 px-2 border-b border-gray-200",children:[e.author," : ",e.message]},t)}))}),(0,a.jsxs)("div",{className:"border-t border-gray-300 w-full flex rounded-bl-md",children:[(0,a.jsx)("input",{type:"text",placeholder:"New message...",value:d,className:"outline-none py-2 px-2 rounded-bl-md flex-1",onChange:function(e){return m(e.target.value)},onKeyUp:function(e){13===e.keyCode&&d&&E()}}),(0,a.jsx)("div",{className:"border-l border-gray-300 flex justify-center items-center rounded-br-md group hover:bg-purple-500 transition-all",children:(0,a.jsx)("button",{className:"group-hover:text-white px-3 h-full",onClick:function(){E()},children:"Send"})})]}),(0,a.jsx)(y.Ix,{})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"font-bold text-black text-xl",children:"How people should call you?"}),(0,a.jsx)("input",{type:"text",placeholder:"Enter your name",value:t,className:" input input-bordered bg-gray-100 border-black text-gray-700",onChange:function(e){return r(e.target.value)}}),(0,a.jsx)(u.s,{onClick:function(){f(t)},text:"Go!"})]})})})})}}}]);